d3.floorplan=function(){function a(a){var m=xScale.range()[1]-xScale.range()[0],l=yScale.range()[1]-yScale.range()[0];a.each(function(a){if(a){var f=d3.select(this);f.selectAll("defs").data([0]).enter().append("defs").each(function(){var a=d3.select(this),b=a.append("radialGradient").attr("id","metal-bump").attr("cx","50%").attr("cy","50%").attr("r","50%").attr("fx","50%").attr("fy","50%");b.append("stop").attr("offset","0%").style("stop-color","rgb(170,170,170)").style("stop-opacity",0.6);b.append("stop").attr("offset",
"100%").style("stop-color","rgb(204,204,204)").style("stop-opacity",0.5);a=a.append("pattern").attr("id","grip-texture").attr("patternUnits","userSpaceOnUse").attr("x",0).attr("y",0).attr("width",3).attr("height",3);a.append("rect").attr("height",3).attr("width",3).attr("stroke","none").attr("fill","rgba(204,204,204,0.5)");a.append("circle").attr("cx",1.5).attr("cy",1.5).attr("r",1).attr("stroke","none").attr("fill","url(#metal-bump)")});var e=f.selectAll(".map-layers").data([0]),b=e.enter().append("g").attr("class",
"map-layers"),d=d3.transition(e);b.append("rect").attr("class","canvas").attr("pointer-events","all").style("opacity",0);d.attr("width",m).attr("height",l).attr("x",xScale.range()[0]).attr("y",yScale.range()[0]);b=f.selectAll(".map-controls").data([0]);b.enter().append("g").attr("class","map-controls").each(function(){var a=d3.select(this);a.append("path").attr("class","ui-show-hide").attr("d","M10,3 v40 h-7 a3,3 0 0,1 -3,-3 v-34 a3,3 0 0,1 3,-3 Z").attr("fill","url(#grip-texture)").attr("stroke",
"none").style("opacity",0.5);a.append("path").attr("class","show ui-show-hide").attr("d","M2,23 l6,-15 v30 Z").attr("fill","rgb(204,204,204)").attr("stroke","none").style("opacity",0.5);a.append("path").attr("class","hide").attr("d","M8,23 l-6,-15 v30 Z").attr("fill","rgb(204,204,204)").attr("stroke","none").style("opacity",0);a.append("path").attr("d","M10,3 v40 h-7 a3,3 0 0,1 -3,-3 v-34 a3,3 0 0,1 3,-3 Z").attr("pointer-events","all").attr("fill","none").attr("stroke","none").style("cursor","pointer").on("mouseover",
function(){a.selectAll("path.ui-show-hide").style("opacity",1)}).on("mouseout",function(){a.selectAll("path.ui-show-hide").style("opacity",0.5)}).on("click",function(){a.select(".hide").classed("ui-show-hide")?a.transition().duration(1E3).attr("transform","translate("+(a.attr("view-width")-10)+",0)").each("end",function(){a.select(".hide").style("opacity",0).classed("ui-show-hide",!1);a.select(".show").style("opacity",1).classed("ui-show-hide",!0);a.selectAll("path.ui-show-hide").style("opacity",
0.5)}):a.transition().duration(1E3).attr("transform","translate("+(a.attr("view-width")-(j+20))+",0)").each("end",function(){a.select(".show").style("opacity",0).classed("ui-show-hide",!1);a.select(".hide").style("opacity",1).classed("ui-show-hide",!0);a.selectAll("path.ui-show-hide").style("opacity",0.5)})});a.append("rect").attr("x",10).attr("y",0).attr("width",j+10).attr("fill","rgba(204,204,204,0.9)").attr("stroke","none");a.append("g").attr("class","layer-controls").attr("transform","translate(15,5)")});
var d=b.select(".hide").classed("ui-show-hide")?j+20:10,c=Math.max(45,10+20*h.length);b.attr("view-width",m).attr("transform","translate("+(m-d)+",0)").select("rect").attr("height",c);b=b.select("g.layer-controls").selectAll("g").data(h,function(a){return a.id()});d=b.enter().append("g").attr("class",function(a){return a.visible()?"ui-active":"ui-default"}).style("cursor","pointer").on("click",function(a){var b=d3.select(this),c=f.selectAll("g."+a.id());b.classed("ui-active")?(c.style("display","none"),
a.visible(!1),b.classed("ui-active",!1).classed("ui-default",!0)):(c.style("display","inherit"),b.classed("ui-active",!0).classed("ui-default",!1),a.visible(!0))});d.append("rect").attr("x",0).attr("y",1).attr("rx",5).attr("ry",5).attr("width",j).attr("height",18).attr("stroke-width","1px");d.append("text").attr("x",10).attr("y",15).style("font-size","12px").style("font-family","Helvetica, Arial, sans-serif").text(function(a){return a.title()});b.transition().duration(1E3).attr("transform",function(a,
b){return"translate(0,"+20*(h.length-(b+1))+")"});e=e.selectAll(".maplayer").data(h,function(a){return a.id()});e.enter().append("g").attr("class",function(a){return"maplayer "+a.title()}).append("g").attr("class",function(a){return a.id()}).attr("style",function(a){return a.visible()?"display:inherit":"display:none"}).datum(null);e.exit().remove();e.order();e.each(function(b){d3.select(this).select("g."+b.id()).datum(a[b.id()]).call(b)});f.call(d3.behavior.zoom().scaleExtent([1,i]).on("zoom",function(){if(g){var a=
d3.event.scale,b=d3.event.translate;f&&(a&&(f.__scale__=a),b&&1<b.length&&(f.__translate__=b),a=(1-f.__scale__)*(xScale.range()[1]-xScale.range()[0]),b=(1-f.__scale__)*(yScale.range()[1]-yScale.range()[0]),f.__translate__[0]=Math.min(xScale.range()[0],Math.max(f.__translate__[0],a)),f.__translate__[1]=Math.min(yScale.range()[0],Math.max(f.__translate__[1],b)),f.selectAll(".map-layers").attr("transform","translate("+f.__translate__+")scale("+f.__scale__+")"))}}))}})}var h=[],g=!0,i=5,j=95;xScale=d3.scale.linear();
yScale=d3.scale.linear();a.xScale=function(d){if(!arguments.length)return xScale;xScale=d;h.forEach(function(a){a.xScale(xScale)});return a};a.yScale=function(d){if(!arguments.length)return yScale;yScale=d;h.forEach(function(a){a.yScale(yScale)});return a};a.maxZoom=function(d){if(!arguments.length)return i;i=d;return a};a.layersWidth=function(d){if(!arguments.length)return j;j=d;return a};a.panZoom=function(d){if(!arguments.length)return g;g=d;return a};a.addLayer=function(d,g){d.xScale(xScale);
d.yScale(yScale);1<arguments.length&&0<=g?h.splice(g,0,d):h.push(d);return a};return a};d3.floorplan.version="0.1.0";d3.floorplan.imagelayer=function(){function a(a){a.each(function(a){a&&(a=d3.select(this).selectAll("image").data(a,function(a){return a.url}),a.enter().append("image").attr("xlink:href",function(a){return a.url}).style("opacity",1E-6),a.exit().transition().style("opacity",1E-6).remove(),a.transition().attr("x",function(a){return h(a.x)}).attr("y",function(a){return g(a.y)}).attr("height",function(a){return g(a.y+a.height)-g(a.y)}).attr("width",function(a){return h(a.x+a.width)-h(a.x)}).style("opacity",
function(a){return a.opacity||1}))})}var h=d3.scale.linear(),g=d3.scale.linear(),i="imagelayer",j=!0;"undefined"==typeof d3.floorplan.imagelayer.prototype.__id&&(d3.floorplan.imagelayer.prototype.__id=0);var d="fp-imagelayer-"+(new Date).valueOf()+d3.floorplan.imagelayer.prototype.__id++;a.xScale=function(d){if(!arguments.length)return h;h=d;return a};a.yScale=function(d){if(!arguments.length)return g;g=d;return a};a.id=function(){return d};a.title=function(d){if(!arguments.length)return i;i=d;return a};
a.visible=function(d){if(!arguments.length)return j;j=d;return a};return a};d3.floorplan.heatmap=function(){function a(a){a.each(function(a){if(a&&a.map){var e=d3.select(this);a.units?" "!=a.units.charAt(0)&&(a.units=" "+a.units):a.units="";var c=a.map.map(function(a){return a.value}).sort(d3.ascending),k,f;switch(g){case "quantile":k=d3.scale.quantile().range([1,2,3,4,5,6]).domain(c);f=k.quantiles();break;case "quantized":k=d3.scale.quantize().range([1,2,3,4,5,6]).domain([c[0],c[c.length-1]]);c=(k.domain()[1]-k.domain()[0])/6;f=[c,2*c,3*c,4*c,5*c];break;case "normal":var l=
d3.mean(c),c=Math.sqrt(d3.sum(c,function(a){return Math.pow(a-l,2)})/c.length);k=d3.scale.quantile().range([1,2,3,4,5,6]).domain([l-6*c,l-2*c,l-c,l,l+c,l+2*c,l+6*c]);f=k.quantiles();break;default:customThresholds||(customThresholds=f),c=customThresholds,c.push(c[c.length-1]),c.unshift(c[0]),k=d3.scale.quantile().range([1,2,3,4,5,6]).domain(c),customThresholds=f=k.quantiles()}e=e.selectAll("g.heatmap").data([0]);e.enter().append("g").attr("class","heatmap");this.__colors__&&this.__colors__!=h&&e.classed(this.__colors__,
!1);e.classed(h,!0);this.__colors__=h;c=e.selectAll("rect").data(a.map.filter(function(a){return!a.points}),function(a){return a.x+","+a.y});f=c.enter().append("rect").style("opacity",1E-6);c.exit().transition().style("opacity",1E-6).remove();f.append("title");c.attr("x",function(a){return i(a.x)}).attr("y",function(a){return j(a.y)}).attr("height",Math.abs(j(a.binSize)-j(0))).attr("width",Math.abs(i(a.binSize)-i(0))).attr("class",function(a){return"d6-"+k(a.value)}).select("title").text(function(c){return"value: "+
m(c.value)+a.units});f.transition().style("opacity",0.6);c=e.selectAll("path").data(a.map.filter(function(a){return a.points}),function(a){return JSON.stringify(a.points)});f=c.enter().append("path").attr("d",function(a){return d(a.points)+"Z"}).style("opacity",1E-6);c.exit().transition().style("opacity",1E-6).remove();f.append("title");c.attr("class",function(a){return"d6-"+k(a.value)}).select("title").text(function(c){return"value: "+m(c.value)+a.units});f.transition().style("opacity",0.6);e=e.selectAll("text").data(a.map.filter(function(a){return a.points}),
function(a){return JSON.stringify(a.points)});c=e.enter().append("text").style("font-weight","bold").attr("text-anchor","middle").style("opacity",1E-6);e.exit().transition().style("opacity",1E-6).remove();e.attr("transform",function(a){for(var c=0,b=0,e=0,k=0;k<a.points.length;++k)var f=a.points[k],d=a.points[k+1]||a.points[0],g=f.x*d.y-d.x*f.y,c=c+(f.x+d.x)*g,b=b+(f.y+d.y)*g,e=e+g;e=e/2;b=b/(6*e);return"translate("+i(c/(6*e))+","+j(b)+")"}).text(function(c){return m(c.value)+a.units});c.transition().style("opacity",
0.6)}})}var h="RdYlBu",g="quantile",i=d3.scale.linear(),j=d3.scale.linear(),d=d3.svg.line().x(function(a){return i(a.x)}).y(function(a){return j(a.y)}),m=d3.format(".4n"),l="heatmap",k=!0;"undefined"==typeof d3.floorplan.heatmap.prototype.__id&&(d3.floorplan.heatmap.prototype.__id=0);var f="fp-heatmap-"+(new Date).valueOf()+d3.floorplan.heatmap.prototype.__id++;a.xScale=function(e){if(!arguments.length)return i;i=e;return a};a.yScale=function(e){if(!arguments.length)return j;j=e;return a};a.colorSet=
function(e){if(!arguments.length)return h;h=e;return a};a.colorMode=function(e){if(!arguments.length)return g;g=e;return a};a.customThresholds=function(e){if(!arguments.length)return customThresholds;customThresholds=e;return a};a.id=function(){return f};a.title=function(e){if(!arguments.length)return l;l=e;return a};a.visible=function(e){if(!arguments.length)return k;k=e;return a};return a};d3.floorplan.overlays=function(){function a(a){a.each(function(a){if(a){var c=d3.select(this),b=c.selectAll("rect.overlay-canvas").data([0]);b.enter().append("rect").attr("class","overlay-canvas").style("opacity",0).attr("pointer-events","all").on("click",function(){if(k){var a=d3.mouse(this);d.forEach(function(b){b(g.invert(a[0]),i.invert(a[1]))})}}).on("mouseup.drag",h).on("touchend.drag",h);b.attr("x",g.range()[0]).attr("y",i.range()[0]).attr("height",i.range()[1]-i.range()[0]).attr("width",g.range()[1]-
g.range()[0]);b=c.selectAll("path.polygon").data(a.polygons||[],function(a){return a.id});b.enter().append("path").attr("class","polygon").attr("vector-effect","non-scaling-stroke").attr("pointer-events","all").on("mousedown",function(a){m.forEach(function(b){b(a.id)})}).call(e).append("title");b.exit().transition().style("opacity",1E-6).remove();b.attr("d",function(a){return f(a.points)+"Z"}).style("cursor",k?"move":"pointer").select("title").text(function(a){return a.name||a.id});var l=[];a.polygons&&
a.polygons.forEach(function(a){a.points.forEach(function(b,c){l.push({index:c,parent:a})})});a.points&&a.points.forEach(function(a){l.push(a)});a=1;for(b=c.node();b.parentNode;)if(b=b.parentNode,b.__scale__){a=b.__scale__;break}c=c.selectAll("circle.vertex").data(l,function(a){return a.parent?a.parent.id+"-"+a.index:a.id});c.exit().transition().attr("r",1E-6).remove();c.enter().append("circle").attr("class","vertex").attr("pointer-events","all").attr("vector-effect","non-scaling-stroke").style("cursor",
"pointer").attr("r",1E-6).on("mouseup",function(a){a.x&&!moved&&m.forEach(function(b){b(a.id)})}).call(e);c.attr("cx",function(a){return g(a.parent?a.parent.points[a.index].x:a.x)}).attr("cy",function(a){return i(a.parent?a.parent.points[a.index].y:a.y)}).attr("r",3/a)}})}function h(){b&&moved&&(moved=!1,l.forEach(function(a){b.parent?a(b.parent.id,b.parent.points,b.index):b.points?a(b.id,b.points):a(b.id,null)}),b=null)}var g=d3.scale.linear(),i=d3.scale.linear(),j="overlays",d=[],m=[],l=[],k=!1,
f=d3.svg.line().x(function(a){return g(a.x)}).y(function(a){return i(a.y)}),e=d3.behavior.drag().on("dragstart",function(a){k&&(b=a,moved=!1)}).on("drag",function(){if(b){var c=g.invert(d3.event.dx)-g.invert(0),e=i.invert(d3.event.dy)-i.invert(0);moved=!0;b.parent?(b.parent.points[b.index].x+=c,b.parent.points[b.index].y+=e):b.points?b.points.forEach(function(a){a.x+=c;a.y+=e}):b.x&&(b.x+=c,b.y+=e);a(d3.select(this.parentNode))}}).on("dragend",h),b=null;moved=!1;vis=!0;"undefined"==typeof d3.floorplan.overlays.prototype.__id&&
(d3.floorplan.overlays.prototype.__id=0);var n="fp-overlays-"+(new Date).valueOf()+d3.floorplan.overlays.prototype.__id++;a.xScale=function(b){if(!arguments.length)return g;g=b;return a};a.yScale=function(b){if(!arguments.length)return i;i=b;return a};a.id=function(){return n};a.title=function(b){if(!arguments.length)return j;j=b;return a};a.visible=function(b){if(!arguments.length)return vis;vis=b;return a};a.editMode=function(b){if(!arguments.length)return k;k=b;return a};a.registerCanvasCallback=
function(b){arguments.length&&d.push(b);return a};a.registerSelectCallback=function(b){arguments.length&&m.push(b);return a};a.registerMoveCallback=function(b){arguments.length&&l.push(b);return a};return a};d3.floorplan.vectorfield=function(){function a(a){a.each(function(a){if(a&&a.map){var f=d3.select(this).selectAll("path.vector").data(a.map,function(a){return a.x+","+a.y});f.exit().transition().style("opacity",1E-6).remove();f.enter().append("path").attr("class","vector").attr("vector-effect","non-scaling-stroke").style("opacity",1E-6).append("title");var e=a.binSize/2/d3.max(a.map,function(a){return Math.max(Math.abs(a.value.x),Math.abs(a.value.y))});f.attr("d",function(b){var f={x:b.x+a.binSize/
2,y:b.y+a.binSize/2};return i([f,{x:f.x+b.value.x*e,y:f.y+b.value.y*e}])}).select("title").text(function(b){return Math.sqrt(b.value.x*b.value.x+b.value.y*b.value.y)+" "+a.units});f.transition().style("opacity",1)}})}var h=d3.scale.linear(),g=d3.scale.linear(),i=d3.svg.line().x(function(a){return h(a.x)}).y(function(a){return g(a.y)}),j="vectorfield",d=!0;"undefined"==typeof d3.floorplan.vectorfield.prototype.__id&&(d3.floorplan.vectorfield.prototype.__id=0);var m="fp-vectorfield-"+(new Date).valueOf()+
d3.floorplan.vectorfield.prototype.__id++;a.xScale=function(d){if(!arguments.length)return h;h=d;return a};a.yScale=function(d){if(!arguments.length)return g;g=d;return a};a.id=function(){return m};a.title=function(d){if(!arguments.length)return j;j=d;return a};a.visible=function(g){if(!arguments.length)return d;d=g;return a};return a};d3.floorplan.pathplot=function(){function a(a){a.each(function(a){a&&(a=d3.select(this).selectAll("path").data(a,function(a){return a.id}),a.exit().transition().style("opacity",1E-6).remove(),a.enter().append("path").attr("vector-effect","non-scaling-stroke").attr("fill","none").style("opacity",1E-6).append("title"),a.attr("class",function(a){return a.classes||a.id}).attr("d",function(a,b){return i(d(a,b))}).select("title").text(function(a){return a.title||a.id}),a.transition().style("opacity",1))})}
var h=d3.scale.linear(),g=d3.scale.linear(),i=d3.svg.line().x(function(a){return h(a.x)}).y(function(a){return g(a.y)}),j="pathplot",d=function(a){return a.points},m=!0;"undefined"==typeof d3.floorplan.pathplot.prototype.__id&&(d3.floorplan.pathplot.prototype.__id=0);var l="fp-pathplot-"+(new Date).valueOf()+d3.floorplan.pathplot.prototype.__id++;a.xScale=function(d){if(!arguments.length)return h;h=d;return a};a.yScale=function(d){if(!arguments.length)return g;g=d;return a};a.id=function(){return l};
a.title=function(d){if(!arguments.length)return j;j=d;return a};a.pointFilter=function(g){if(!arguments.length)return d;d=g;return a};a.visible=function(d){if(!arguments.length)return m;m=d;return a};return a};