d3.floorplan=function(){function a(a){var k=xScale.range()[1]-xScale.range()[0],h=yScale.range()[1]-yScale.range()[0];a.each(function(a){if(a){var d=d3.select(this);d.selectAll("defs").data([0]).enter().append("defs").each(function(){var a=d3.select(this),b=a.append("radialGradient").attr("id","metal-bump").attr("cx","50%").attr("cy","50%").attr("r","50%").attr("fx","50%").attr("fy","50%");b.append("stop").attr("offset","0%").style("stop-color","rgb(170,170,170)").style("stop-opacity",0.6);b.append("stop").attr("offset",
"100%").style("stop-color","rgb(204,204,204)").style("stop-opacity",0.5);a=a.append("pattern").attr("id","grip-texture").attr("patternUnits","userSpaceOnUse").attr("x",0).attr("y",0).attr("width",3).attr("height",3);a.append("rect").attr("height",3).attr("width",3).attr("stroke","none").attr("fill","rgba(204,204,204,0.5)");a.append("circle").attr("cx",1.5).attr("cy",1.5).attr("r",1).attr("stroke","none").attr("fill","url(#metal-bump)")});var l=d.selectAll(".map-layers").data([0]),c=l.enter().append("g").attr("class",
"map-layers"),b=d3.transition(l);c.append("rect").attr("class","canvas").attr("pointer-events","all").style("opacity",0);b.attr("width",k).attr("height",h).attr("x",xScale.range()[0]).attr("y",yScale.range()[0]);c=d.selectAll(".map-controls").data([0]);c.enter().append("g").attr("class","map-controls").each(function(){var a=d3.select(this);a.append("path").attr("class","ui-show-hide").attr("d","M10,3 v40 h-7 a3,3 0 0,1 -3,-3 v-34 a3,3 0 0,1 3,-3 Z").attr("fill","url(#grip-texture)").attr("stroke",
"none").style("opacity",0.5);a.append("path").attr("class","show ui-show-hide").attr("d","M2,23 l6,-15 v30 Z").attr("fill","rgb(204,204,204)").attr("stroke","none").style("opacity",0.5);a.append("path").attr("class","hide").attr("d","M8,23 l-6,-15 v30 Z").attr("fill","rgb(204,204,204)").attr("stroke","none").style("opacity",0);a.append("path").attr("d","M10,3 v40 h-7 a3,3 0 0,1 -3,-3 v-34 a3,3 0 0,1 3,-3 Z").attr("pointer-events","all").attr("fill","none").attr("stroke","none").style("cursor","pointer").on("mouseover",
function(){a.selectAll("path.ui-show-hide").style("opacity",1)}).on("mouseout",function(){a.selectAll("path.ui-show-hide").style("opacity",0.5)}).on("click",function(){a.select(".hide").classed("ui-show-hide")?a.transition().duration(1E3).attr("transform","translate("+(a.attr("view-width")-10)+",0)").each("end",function(){a.select(".hide").style("opacity",0).classed("ui-show-hide",!1);a.select(".show").style("opacity",1).classed("ui-show-hide",!0);a.selectAll("path.ui-show-hide").style("opacity",
0.5)}):a.transition().duration(1E3).attr("transform","translate("+(a.attr("view-width")-(i+20))+",0)").each("end",function(){a.select(".show").style("opacity",0).classed("ui-show-hide",!1);a.select(".hide").style("opacity",1).classed("ui-show-hide",!0);a.selectAll("path.ui-show-hide").style("opacity",0.5)})});a.append("rect").attr("x",10).attr("y",0).attr("width",i+10).attr("fill","rgba(204,204,204,0.9)").attr("stroke","none");a.append("g").attr("class","layer-controls").attr("transform","translate(15,5)")});
var b=c.select(".hide").classed("ui-show-hide")?i+20:10,j=Math.max(45,10+20*e.length);c.attr("view-width",k).attr("transform","translate("+(k-b)+",0)").select("rect").attr("height",j);c=c.select("g.layer-controls").selectAll("g").data(e,function(a){return a.id()});b=c.enter().append("g").attr("class","ui-active").style("cursor","pointer").on("click",function(a){var b=d3.select(this),a=d.selectAll("g."+a.id());b.classed("ui-active")?(a.style("display","none"),b.classed("ui-active",!1).classed("ui-default",
!0)):(a.style("display","inherit"),b.classed("ui-active",!0).classed("ui-default",!1))});b.append("rect").attr("x",0).attr("y",1).attr("rx",5).attr("ry",5).attr("width",i).attr("height",18).attr("stroke-width","1px");b.append("text").attr("x",10).attr("y",15).style("font-size","12px").style("font-family","Helvetica, Arial, sans-serif").text(function(a){return a.title()});c.transition().duration(1E3).attr("transform",function(a,b){return"translate(0,"+20*(e.length-(b+1))+")"});l=l.selectAll(".maplayer").data(e,
function(a){return a.id()});l.enter().append("g").attr("class",function(a){return"maplayer "+a.title()}).append("g").attr("class",function(a){return a.id()}).datum(null);l.exit().remove();l.order();l.each(function(b){d3.select(this).select("g."+b.id()).datum(a[b.id()]).call(b)});d.call(d3.behavior.zoom().scaleExtent([1,g]).on("zoom",function(){if(f){var a=d3.event.scale,b=d3.event.translate;d&&(a&&(d.__scale__=a),b&&1<b.length&&(d.__translate__=b),a=(1-d.__scale__)*(xScale.range()[1]-xScale.range()[0]),
b=(1-d.__scale__)*(yScale.range()[1]-yScale.range()[0]),d.__translate__[0]=Math.min(xScale.range()[0],Math.max(d.__translate__[0],a)),d.__translate__[1]=Math.min(yScale.range()[0],Math.max(d.__translate__[1],b)),d.selectAll(".map-layers").attr("transform","translate("+d.__translate__+")scale("+d.__scale__+")"))}}))}})}var e=[],f=!0,g=5,i=95;xScale=d3.scale.linear();yScale=d3.scale.linear();a.xScale=function(c){if(!arguments.length)return xScale;xScale=c;e.forEach(function(a){a.xScale(xScale)});return a};
a.yScale=function(c){if(!arguments.length)return yScale;yScale=c;e.forEach(function(a){a.yScale(yScale)});return a};a.maxZoom=function(c){if(!arguments.length)return g;g=c;return a};a.layersWidth=function(c){if(!arguments.length)return i;i=c;return a};a.panZoom=function(c){if(!arguments.length)return f;f=c;return a};a.addLayer=function(c,k){c.xScale(xScale);c.yScale(yScale);1<arguments.length&&0<=k?e.splice(k,0,c):e.push(c);return a};return a};d3.floorplan.version="0.1.0";d3.floorplan.imagelayer=function(){function a(a){a.each(function(a){a&&(a=d3.select(this).selectAll("image").data(a,function(a){return a.url}),a.enter().append("image").attr("xlink:href",function(a){return a.url}).style("opacity",1E-6),a.exit().transition().style("opacity",1E-6).remove(),a.transition().attr("x",function(a){return e(a.x)}).attr("y",function(a){return f(a.y)}).attr("height",function(a){return f(a.y+a.height)-f(a.y)}).attr("width",function(a){return e(a.x+a.width)-e(a.x)}).style("opacity",
function(a){return a.opacity||1}))})}var e=d3.scale.linear(),f=d3.scale.linear(),g="fp-imagelayer-"+(new Date).valueOf(),i="imagelayer";a.xScale=function(c){if(!arguments.length)return e;e=c;return a};a.yScale=function(c){if(!arguments.length)return f;f=c;return a};a.id=function(){return g};a.title=function(c){if(!arguments.length)return i;i=c;return a};return a};d3.floorplan.heatmap=function(){function a(a){a.each(function(a){if(a&&a.map){var d=d3.select(this);a.units?" "!=a.units.charAt(0)&&(a.units=" "+a.units):a.units="";var b=a.map.map(function(a){return a.value}).sort(d3.ascending),j,h;switch(f){case "quantile":j=d3.scale.quantile().range([1,2,3,4,5,6]).domain(b);h=j.quantiles();break;case "quantized":j=d3.scale.quantize().range([1,2,3,4,5,6]).domain([b[0],b[b.length-1]]);b=(j.domain()[1]-j.domain()[0])/6;h=[b,2*b,3*b,4*b,5*b];break;case "normal":var m=
d3.mean(b),b=Math.sqrt(d3.sum(b,function(a){return Math.pow(a-m,2)})/b.length);j=d3.scale.quantile().range([1,2,3,4,5,6]).domain([m-6*b,m-2*b,m-b,m,m+b,m+2*b,m+6*b]);h=j.quantiles();break;default:customThresholds||(customThresholds=h),b=customThresholds,b.push(b[b.length-1]),b.unshift(b[0]),j=d3.scale.quantile().range([1,2,3,4,5,6]).domain(b),customThresholds=h=j.quantiles()}d=d.selectAll("g.heatmap").data([0]);d.enter().append("g").attr("class","heatmap");this.__colors__&&this.__colors__!=e&&d.classed(this.__colors__,
!1);d.classed(e,!0);this.__colors__=e;b=d.selectAll("rect").data(a.map.filter(function(a){return!a.points}),function(a){return a.x+","+a.y});h=b.enter().append("rect").style("opacity",1E-6);b.exit().transition().style("opacity",1E-6).remove();h.append("title");b.attr("x",function(a){return g(a.x)}).attr("y",function(a){return i(a.y)}).attr("height",Math.abs(i(a.binSize)-i(0))).attr("width",Math.abs(g(a.binSize)-g(0))).attr("class",function(a){return"d6-"+j(a.value)}).select("title").text(function(b){return"value: "+
k(b.value)+a.units});h.transition().style("opacity",0.6);b=d.selectAll("path").data(a.map.filter(function(a){return a.points}),function(a){return JSON.stringify(a.points)});h=b.enter().append("path").attr("d",function(a){return c(a.points)+"Z"}).style("opacity",1E-6);b.exit().transition().style("opacity",1E-6).remove();h.append("title");b.attr("class",function(a){return"d6-"+j(a.value)}).select("title").text(function(b){return"value: "+k(b.value)+a.units});h.transition().style("opacity",0.6);d=d.selectAll("text").data(a.map.filter(function(a){return a.points}),
function(a){return JSON.stringify(a.points)});b=d.enter().append("text").style("font-weight","bold").attr("text-anchor","middle").style("opacity",1E-6);d.exit().transition().style("opacity",1E-6).remove();d.attr("transform",function(a){for(var b=0,d=0,h=0,j=0;j<a.points.length;++j)var c=a.points[j],e=a.points[j+1]||a.points[0],f=c.x*e.y-e.x*c.y,b=b+(c.x+e.x)*f,d=d+(c.y+e.y)*f,h=h+f;h=h/2;d=d/(6*h);return"translate("+g(b/(6*h))+","+i(d)+")"}).text(function(b){return k(b.value)+a.units});b.transition().style("opacity",
0.6)}})}var e="RdYlBu",f="quantile",g=d3.scale.linear(),i=d3.scale.linear(),c=d3.svg.line().x(function(a){return g(a.x)}).y(function(a){return i(a.y)}),k=d3.format(".4n"),h="fp-heatmap-"+(new Date).valueOf(),n="heatmap";a.xScale=function(d){if(!arguments.length)return g;g=d;return a};a.yScale=function(d){if(!arguments.length)return i;i=d;return a};a.colorSet=function(d){if(!arguments.length)return e;e=d;return a};a.colorMode=function(d){if(!arguments.length)return f;f=d;return a};a.customThresholds=
function(d){if(!arguments.length)return customThresholds;customThresholds=d;return a};a.id=function(){return h};a.title=function(d){if(!arguments.length)return n;n=d;return a};return a};d3.floorplan.overlays=function(){function a(a){a.each(function(a){if(a){var b=d3.select(this),c=b.selectAll("rect.overlay-canvas").data([0]);c.enter().append("rect").attr("class","overlay-canvas").style("opacity",0).attr("pointer-events","all").on("click",function(){if(d){var a=d3.mouse(this);k.forEach(function(b){b(f.invert(a[0]),g.invert(a[1]))})}}).on("mouseup.drag",e).on("touchend.drag",e);c.attr("x",f.range()[0]).attr("y",g.range()[0]).attr("height",g.range()[1]-g.range()[0]).attr("width",f.range()[1]-
f.range()[0]);c=b.selectAll("path.polygon").data(a.polygons||[],function(a){return a.id});c.enter().append("path").attr("class","polygon").attr("vector-effect","non-scaling-stroke").attr("pointer-events","all").on("mousedown",function(a){h.forEach(function(b){b(a.id)})}).call(o).append("title");c.exit().transition().style("opacity",1E-6).remove();c.attr("d",function(a){return l(a.points)+"Z"}).style("cursor",d?"move":"pointer").select("title").text(function(a){return a.name||a.id});var j=[];a.polygons&&
a.polygons.forEach(function(a){a.points.forEach(function(b,d){j.push({index:d,parent:a})})});a.points&&a.points.forEach(function(a){j.push(a)});a=1;for(c=b.node();c.parentNode;)if(c=c.parentNode,c.__scale__){a=c.__scale__;break}b=b.selectAll("circle.vertex").data(j,function(a){return a.parent?a.parent.id+"-"+a.index:a.id});b.exit().transition().attr("r",1E-6).remove();b.enter().append("circle").attr("class","vertex").attr("pointer-events","all").attr("vector-effect","non-scaling-stroke").style("cursor",
"pointer").attr("r",1E-6).on("mouseup",function(a){a.x&&!moved&&h.forEach(function(b){b(a.id)})}).call(o);b.attr("cx",function(a){return f(a.parent?a.parent.points[a.index].x:a.x)}).attr("cy",function(a){return g(a.parent?a.parent.points[a.index].y:a.y)}).attr("r",3/a)}})}function e(){b&&moved&&(moved=!1,n.forEach(function(a){b.parent?a(b.parent.id,b.parent.points,b.index):b.points?a(b.id,b.points):a(b.id,null)}),b=null)}var f=d3.scale.linear(),g=d3.scale.linear(),i="fp-overlays-"+(new Date).valueOf(),
c="overlays",k=[],h=[],n=[],d=!1,l=d3.svg.line().x(function(a){return f(a.x)}).y(function(a){return g(a.y)}),o=d3.behavior.drag().on("dragstart",function(a){d&&(b=a,moved=!1)}).on("drag",function(){if(b){var d=f.invert(d3.event.dx)-f.invert(0),c=g.invert(d3.event.dy)-g.invert(0);moved=!0;b.parent?(b.parent.points[b.index].x+=d,b.parent.points[b.index].y+=c):b.points?b.points.forEach(function(a){a.x+=d;a.y+=c}):b.x&&(b.x+=d,b.y+=c);a(d3.select(this.parentNode))}}).on("dragend",e),b=null;moved=!1;a.xScale=
function(b){if(!arguments.length)return f;f=b;return a};a.yScale=function(b){if(!arguments.length)return g;g=b;return a};a.id=function(){return i};a.title=function(b){if(!arguments.length)return c;c=b;return a};a.editMode=function(b){if(!arguments.length)return d;d=b;return a};a.registerCanvasCallback=function(b){arguments.length&&k.push(b);return a};a.registerSelectCallback=function(b){arguments.length&&h.push(b);return a};a.registerMoveCallback=function(b){arguments.length&&n.push(b);return a};
return a};d3.floorplan.vectorfield=function(){function a(a){a.each(function(a){if(a&&a.map){var c=d3.select(this).selectAll("path.vector").data(a.map,function(a){return a.x+","+a.y});c.exit().transition().style("opacity",1E-6).remove();c.enter().append("path").attr("class","vector").attr("vector-effect","non-scaling-stroke").style("opacity",1E-6).append("title");var d=a.binSize/2/d3.max(a.map,function(a){return Math.max(Math.abs(a.value.x),Math.abs(a.value.y))});c.attr("d",function(c){var e={x:c.x+a.binSize/
2,y:c.y+a.binSize/2};return g([e,{x:e.x+c.value.x*d,y:e.y+c.value.y*d}])}).select("title").text(function(c){return Math.sqrt(c.value.x*c.value.x+c.value.y*c.value.y)+" "+a.units});c.transition().style("opacity",1)}})}var e=d3.scale.linear(),f=d3.scale.linear(),g=d3.svg.line().x(function(a){return e(a.x)}).y(function(a){return f(a.y)}),i="fp-vectorfield-"+(new Date).valueOf(),c="vectorfield";a.xScale=function(c){if(!arguments.length)return e;e=c;return a};a.yScale=function(c){if(!arguments.length)return f;
f=c;return a};a.id=function(){return i};a.title=function(a){if(!arguments.length)return c;c=a;return images};return a};d3.floorplan.pathplot=function(){function a(a){a.each(function(a){a&&(a=d3.select(this).selectAll("path").data(a,function(a){return a.id}),a.exit().transition().style("opacity",1E-6).remove(),a.enter().append("path").attr("vector-effect","non-scaling-stroke").attr("fill","none").style("opacity",1E-6).append("title"),a.attr("class",function(a){return a.classes||a.id}).attr("d",function(a,c){return g(k(a,c))}).select("title").text(function(a){return a.title||a.id}),a.transition().style("opacity",1))})}
var e=d3.scale.linear(),f=d3.scale.linear(),g=d3.svg.line().x(function(a){return e(a.x)}).y(function(a){return f(a.y)}),i="fp-pathplot-"+(new Date).valueOf(),c="pathplot",k=function(a){return a.points};a.xScale=function(c){if(!arguments.length)return e;e=c;return a};a.yScale=function(c){if(!arguments.length)return f;f=c;return a};a.id=function(){return i};a.title=function(e){if(!arguments.length)return c;c=e;return a};a.pointFilter=function(c){if(!arguments.length)return k;k=c;return a};return a};